<!DOCTYPE html>
<html>
	<head>
		<title>WebWorker test</title>
		<script src='src/collection.js'></script>
		<script src='extra/gen-lrs-data.js'></script>
		<script>
			function ready(){
				var handle = setInterval(function(){document.body.innerHTML += '.';}, 20);
				console.time('Total operating time');

				var c = new ADL.CollectionAsync(window.statements, 'src/collection-worker.js');
				c.where('result.score.raw != null')
					//.groupBy('timestamp', ['2014-04-29T04:50:00-05:00', '2014-04-29T04:45:00-05:00', -30*ADL.Collection.second])
					.join('group',
						function(data){data.groupBy('result.score.raw', [95,100,1]);},
						function(data){data.groupBy('result.score.raw', [95,100,1]).count();}
					)
					.select('group, count, data')
					.exec(function(msg){
						clearInterval(handle);
						console.timeEnd('Total operating time');
						document.body.innerHTML += '<pre>'+JSON.stringify(msg, null, '    ')+'</pre>';
						console.log('Result length', msg.length);
					});
			};
		</script>
	</head>
	<body onload='ready()'>
	</body>
</html>
