"use strict";try{window.ADL=window.ADL||{}}catch(e){var window={ADL:{}}}try{var workerScript=document.querySelector('script[src*="xapiCollection"]').src}catch(e){}Array.isArray||(Array.isArray=function(t){return t.length>=0&&!t.length}),function(t){function r(t,e){if(void 0===e)return null;if(0===t.length)return e;var n;if(Array.isArray(t))n=t;else{n=t.split(".");for(var a=0;a<n.length;)"\\"===n[a].charAt(n[a].length-1)?n.splice(a,2,n[a].slice(0,-1)+"."+n[a+1]):a++}var o=n[0],s=n.slice(1);return r(s,e[o])}function e(t,r){this.contents=Array.isArray(t)?t.slice():[],this.parent=r}function n(t){if(this._callbacks={},!window.Worker)throw new Error("Your browser does not support WebWorkers, and cannot use the CollectionAsync class. Use CollectionSync instead.");this.worker=new Worker(workerScript),this.worker.onmessage=function(t){var r=n.deserialize(t.data);this._callbacks[r[0]]&&(this._callbacks[r[0]](r[1]),delete this._callbacks[r[0]])}.bind(this);var r=n.serialize(["push",t]);try{this.worker.postMessage(r,[r])}catch(e){this.worker.postMessage(r)}r.byteLength>0&&console.log("Warning: Your browser does not support WebWorker transfers. Performance of this site may suffer as a result.")}function a(t){return function(){var r=Array.prototype.slice.call(arguments);return this.worker.postMessage(n.serialize([t].concat(r))),this}}e.prototype.exec=function(t){return t(this.contents),this.parent},e.prototype.save=function(){return new e(this.contents,this)},e.prototype.append=function(t){return this.contents.push.apply(this.contents,t),this},e.prototype.where=function(t){function e(t){function r(t){var e=/^\s*\((.*)\)\s*$/.exec(t);return e?r(e[1]):n(t)}function e(t){for(var r=0,e=0;e<t.length;e++)"("===t[e]?r++:")"===t[e]&&r--;return 0===r}function n(t){for(var n=t.split(/\bor\b/),s="",i="",u=1;u<n.length;u++){var c=n.slice(0,u).join("or"),p=n.slice(u).join("or");if(""!=c&&e(c)&&""!=p&&e(p)){s=c,i=p;break}}if(s&&i){var l=r(s),h=r(i);return l&&h?{or:[l,h]}:a}var f=o(t);return f?f:a}function o(t){for(var n=t.split(/\band\b/),o="",i="",u=1;u<n.length;u++){var c=n.slice(0,u).join("and"),p=n.slice(u).join("and");if(""!=c&&e(c)&&""!=p&&e(p)){o=c,i=p;break}}if(o&&i){var l=r(o),h=r(i);return l&&h?{and:[l,h]}:a}var f=s(t);return f?f:a}function s(t){var r=/^\s*(.*?)\s*(!=|>=|<=|=|>|<)\s*(.*)\s*$/.exec(t);if(!r)return a;var e=i(r[1]),n=u(r[3]);if(!e)return a;if(n instanceof RegExp)return"="===r[2]?{op:"re",xpath:e,value:n}:"!="===r[2]?{op:"nre",xpath:e,value:n}:(console.error("Regex comparison only supports = and !="),a);switch(r[2]){case"=":return{op:"eq",xpath:e,value:n};case"!=":return{op:"neq",xpath:e,value:n};case"<":return{op:"lt",xpath:e,value:n};case"<=":return{op:"leq",xpath:e,value:n};case">":return{op:"gt",xpath:e,value:n};case">=":return{op:"geq",xpath:e,value:n};default:return a}}function i(t){var r=/^\s*([^\.]+(?:\.[^\.]+)*)\s*$/.exec(t);return r?r[1]:a}function u(t){var r=null,e=t.trim();return(r=parseInt(t,10))?r:(r=parseFloat(t))?r:(r=/^\s*"(.*)"\s*$/.exec(t))?r[1]:(r=/^\s*\/(.*)\/(i?)\s*$/.exec(t))?new RegExp(r[1],r[2]):"null"===e?null:"true"===e||"false"===e?"true"===e:a}var c=r(t);return c!=a?c:null}function n(t,e){if(Array.isArray(t.and)&&0===t.and.length)return!0;if(Array.isArray(t.or)&&0===t.or.length)return!1;if(!t.op)return t.and?n(t.and[0],e)?n({and:t.and.slice(1)},e):!1:t.or?n(t.or[0],e)?!0:n({or:t.or.slice(1)},e):!1;switch(t.op){case"eq":return r(t.xpath,e)===t.value;case"neq":return r(t.xpath,e)!==t.value;case"geq":return r(t.xpath,e)>=t.value;case"leq":return r(t.xpath,e)<=t.value;case"lt":return r(t.xpath,e)<t.value;case"gt":return r(t.xpath,e)>t.value;case"re":return t.value.test(r(t.xpath,e));case"nre":return!t.value.test(r(t.xpath,e));default:return!1}}var a=0/0;if(t){var o=e(t);if(!o)return void console.error("Invalid where expression: "+t);for(var s=0;s<this.contents.length;s++)n(o,this.contents[s])||this.contents.splice(s--,1);return this}},e.prototype.select=function(t){for(var e=[],n=t.split(","),a=0;a<n.length;a++){var o=n[a].split(" as ");e.push({xpath:o[0].trim(),alias:o[1]?o[1].trim():null})}for(var s=this.contents,i=[],a=0;a<s.length;a++){for(var u={},c=0;c<e.length;c++)e[c].alias?u[e[c].alias]=r(e[c].xpath,s[a]):u[e[c].xpath]=r(e[c].xpath,s[a]);i.push(u)}return this.contents=i,this},e.prototype.slice=function(t,r){return null===r&&(r=void 0),this.contents=this.contents.slice(t,r),this},e.prototype.orderBy=function(t,e){var n=this.contents;return e="descending"===e||"desc"===e?-1:1,n.sort(function(n,a){var o=r(t,n),s=r(t,a);return null!=o&&null==s?1*e:null==o&&null!=s?-1*e:o==s?0:(s>o?-1:1)*e}),this},e.prototype._groupByRange=function(t,e){if(!Array.isArray(e)||3!==e.length||e[2]%1!==0)return this.groupBy(t);var n,a,o=e[0],s=e[1],i=e[2];"string"==typeof o&&"string"==typeof s&&Date.parse(o)&&Date.parse(s)?(n=function(t){return Date.parse(t)},a=function(t,r){var e=new Date(Date.parse(t)+r);return e.toISOString()}):"string"==typeof o&&"string"==typeof s?(n=function(t){return t.charAt(0).toLowerCase().charCodeAt(0)-"a".charCodeAt(0)},a=function(t,r){return String.fromCharCode(t.charAt(0).toLowerCase().charCodeAt(0)+r)}):(n=function(t){return t},a=function(t,r){return t+r});var u=[];if((n(s)-n(o))*i<=0)console.error("Group range is open, cannot generate groups!"),console.log(JSON.stringify(e)),u=[o,s];else{if(n(o)>n(s))return groupByRange(t,[s,o,-i]),void dataStack.push(dataStack.pop().reverse());for(var c=o;n(c)<n(s);c=a(c,i))u.push(c);u.push(s)}for(var p=[],c=0;c<u.length-1;c++)p.push({group:u[c]+"-"+u[c+1],groupStart:u[c],groupEnd:u[c+1],data:[]});for(var l=this.contents,c=0;c<l.length;c++)for(var h=n(r(t,l[c])),f=0;f<p.length;f++)n(p[f].groupStart)<=h&&(h<n(p[f].groupEnd)||f==p.length-1&&h==n(p[f].groupEnd))&&p[f].data.push(l[c]);return this.contents=p,this},e.prototype.groupBy=function(t,e){if(e)return this._groupByRange(t,e);for(var n=this.contents,a={},o=0;o<n.length;o++){var s=r(t,n[o]);a[s]?a[s].push(n[o]):a[s]=[n[o]]}var i=[];for(var o in a)i.push({group:o,data:a[o]});return this.contents=i,this},e.prototype.count=function(){var t=this.contents;t[0]&&t[0].group&&t[0].data||(t=[{group:"all",data:t}]);for(var r=[],e=0;e<t.length;e++){var n={};for(var a in t[e])n[a]=t[e][a];n.count=n.data.length,n.sample=n.data[0],r.push(n)}return this.contents=r,this},e.prototype.sum=function(t){if(!t)return this;var e=this.contents;e[0]&&e[0].group&&e[0].data||(e=[{group:"all",data:e}]);for(var n=[],a=0;a<e.length;a++){for(var o=0,s=0;s<e[a].data.length;s++)o+=r(t,e[a].data[s]);var i={};for(var s in e[a])i[s]=e[a][s];i.sum=o,i.sample=i.data[0],n.push(i)}return this.contents=n,this},e.prototype.average=function(t){if(!t)return this;var e=this.contents;e[0]&&e[0].group&&e[0].data||(e=[{group:"all",data:e}]);for(var n=[],a=0;a<e.length;a++){for(var o=0,s=0;s<e[a].data.length;s++)o+=r(t,e[a].data[s]);var i={};for(var s in e[a])i[s]=e[a][s];i.average=i.data.length>0?o/i.data.length:0,i.sample=i.data[0],n.push(i)}return this.contents=n,this},e.prototype.min=function(t){if(!t)return this;var e=this.contents,n=[];e[0]&&e[0].group&&e[0].data||(e=[{group:"all",data:e}]);for(var a=0;a<e.length;a++){for(var o=1/0,s=0;s<e[a].data.length;s++)o=Math.min(o,r(t,e[a].data[s]));var i={};for(var s in e[a])i[s]=e[a][s];i.min=1/0===o?0:o,i.sample=i.data[0],n.push(i)}return this.contents=n,this},e.prototype.max=function(t){if(!t)return this;var e=this.contents;e[0]&&e[0].group&&e[0].data||(e=[{group:"all",data:e}]);for(var n=[],a=0;a<e.length;a++){for(var o=-1/0,s=0;s<e[a].data.length;s++)o=Math.max(o,r(t,e[a].data[s]));var i={};for(var s in e[a])i[s]=e[a][s];i.max=o===-1/0?0:o,i.sample=i.data[0],n.push(i)}return this.contents=n,this},n.serialize=function(t){for(var r=JSON.stringify(t),e=new ArrayBuffer(2*r.length),n=new Uint16Array(e),a=0;a<r.length;a++)n[a]=r.charCodeAt(a);return e},n.deserialize=function(t){for(var r="",e=new Uint16Array(t),n=0;n<e.length;n+=1e3)r+=String.fromCharCode.apply(null,e.subarray(n,n+1e3));return JSON.parse(r)},n.prototype.exec=function(t){for(var r;this._callbacks[r=Math.floor(65536*Math.random())];);return this._callbacks[r]=t,this.worker.postMessage(n.serialize(["exec",r])),this},n.prototype.append=function(t){var r=n.serialize(["append",t]);try{this.worker.postMessage(r,[r])}catch(e){this.worker.postMessage(r)}return this},n.prototype.save=a("save"),n.prototype.where=a("where"),n.prototype.select=a("select"),n.prototype.slice=a("slice"),n.prototype.orderBy=a("orderBy"),n.prototype.groupBy=a("groupBy"),n.prototype.count=a("count"),n.prototype.sum=a("sum"),n.prototype.average=a("average"),n.prototype.min=a("min"),n.prototype.max=a("max"),t.CollectionSync=e,t.CollectionAsync=n,t.Collection=n}(window.ADL),function(t,r){var e=null;try{onmessage=function(n){var a=t.deserialize(n.data);if("exec"===a[0]){var o=a[1];e?e=e.exec(function(r){var e=t.serialize([o,r]);try{postMessage(e,[e])}catch(n){postMessage(e)}}):postMessage(t.serialize([o,"error","nodata"]))}else if("push"===a[0]){var s=new r(a[1],e);e=s}else e=e[a[0]].apply(e,a.slice(1))}}catch(n){if("onmessage is not defined"!==n.message)throw n}}(window.ADL.Collection,window.ADL.CollectionSync);